{"componentChunkName":"component---src-templates-blog-post-js","path":"/state-of-emergency/","result":{"data":{"site":{"siteMetadata":{"title":"Note's on software"}},"markdownRemark":{"id":"213c12e4-1c3c-56ac-9b0c-6225e73b7686","excerpt":"Alert! Your state might already be infected! What if I told you that while you are walking around all happy and content in these times of peace and great…","html":"<h1>Alert! Your state might already be infected!</h1>\n<p>What if I told you that while you are walking around all happy and content in these times of peace and great economic prosperity, your application state might be modeled wrong!</p>\n<p>What if I told you I could help you with that, all while introducing another mnemonic to the world ?!?\nFeel intrigued? Then keep reading!</p>\n<h1>What is state anyway?</h1>\n<p>State is a description of how things are right now.</p>\n<p>Examples:</p>\n<ul>\n<li>The oven is on.</li>\n<li>The traffic light is broken.</li>\n<li>The theme is set to dark-mode</li>\n</ul>\n<h1>The four levels of state</h1>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d2971e31a2fb95d47f58557b400b81c2/2fb2d/the_four_states.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.9746835443038%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABVElEQVQY0z3Rza6CMBAFYN5/5UP4Em7YYEiMYAiaSPG3TVFKG1AaKhQ7c3Mh9367mc2cyfG01t/vFwBwMgzDd+Kcgwkiwp95iX+8MAyDIHi9XuM4IuJms1mv11mWFUUBAJzzPM+zLKvr2lp7vV4550VRUEqNMd4wDEEQRFHEOUdE51w0GYYBEZVSURSdz2dE7PteCHG/3ymlhBCllGeM0VoXRWGMQUQhRBiGnHMppbVWSrnb7Rhjxhil1PF4PJ1OQojP5wMAntb6cDjMl33fXywWq9VqDlZVVRzH2+12P6mqKk3TPM+llE3T/P6cJMlyuUzTdBzHsizjON7v94SQ5/MppSSEPB4PSukcjTFW13XTNEop55x3uVwYYwCglLrdbr7vJ0nSdV1ZlgBQT97v9/9TSikp5Tx6fd9rrdu27SfW2q7r2radK3HO2cncDQDMXc5V/QCA3rZkYxAf2AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"The four level of state\"\n        title=\"The four level of state\"\n        src=\"/static/d2971e31a2fb95d47f58557b400b81c2/f058b/the_four_states.png\"\n        srcset=\"/static/d2971e31a2fb95d47f58557b400b81c2/c26ae/the_four_states.png 158w,\n/static/d2971e31a2fb95d47f58557b400b81c2/6bdcf/the_four_states.png 315w,\n/static/d2971e31a2fb95d47f58557b400b81c2/f058b/the_four_states.png 630w,\n/static/d2971e31a2fb95d47f58557b400b81c2/40601/the_four_states.png 945w,\n/static/d2971e31a2fb95d47f58557b400b81c2/78612/the_four_states.png 1260w,\n/static/d2971e31a2fb95d47f58557b400b81c2/2fb2d/the_four_states.png 1695w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>State-space differs depending on which of these levels we are talking about.\nLet’s dive in to see what they represent.</p>\n<h2>The real world</h2>\n<p>The real world is messy and full of more details than we can even conceive.\nImagine writing software for a washing machine.\nThe most apparent thing about it is that it has one or more knobs conveying different states.</p>\n<p>But it has more than that; it has a color, air inside, spin speed, and hinges, screws, all in different shapes, sizes, and conditions. The list goes on.</p>\n<h2>The abstract state</h2>\n<blockquote>\n<p><strong>The abstract state is a mapping from reality to a much simpler subset that still is useful to model what we are after.</strong></p>\n</blockquote>\n<p>When it comes to data modeling, it’s for us, the programmers, to select such a subset.\nContinuing with the washing machine, maybe the only interesting states for our purposes are:</p>\n<ul>\n<li>is it On or Off?</li>\n<li>is it running?</li>\n<li>What program is it set to?</li>\n</ul>\n<p>And we actively choose not to model</p>\n<ul>\n<li>Electricity consumption</li>\n<li>More descriptive states like Stopped, Ready, Empty, Full,  Error.</li>\n</ul>\n<p><strong>So what is an abstraction ?</strong></p>\n<p>An abstraction is a mapping from a complex set to a simpler one, where operations and results in the abstract domain still tell us something relevant about the original set.\nThat is precisely what we did above with our mapping from the real world to the abstract state.</p>\n<p>I first came across this idea of thinking of the abstraction mapping instead of “the abstraction” by reading Jimmy Koppel’s article <a href=\"https://www.pathsensitive.com/2022/03/abstraction-not-what-you-think-it-is.html\">Abstraction: not what you think it is</a> .</p>\n<p>I have been asked a few times about “what is a good abstraction?” so here is my current <a href=\"https://matt.might.net/articles/intro-static-analysis/\">favorite example</a>.</p>\n<p>Imagine a mapping (abstraction mapping) from the integer\n<code class=\"language-text\">... -3, -2, -1, 0, 1, 2, 3, ...</code> to the set <code class=\"language-text\">{-, 0, +}</code>. This is the abstract domain.\nNegatives to <code class=\"language-text\">{-}</code>, positives to <code class=\"language-text\">{+}</code> and 0 to <code class=\"language-text\">{0}</code>.</p>\n<p>We can also map the <code class=\"language-text\">+</code> and <code class=\"language-text\">*</code> operators to versions operating on the abstract domain</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token punctuation\">{</span><span class=\"token operator\">+</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">+</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">+</span><span class=\"token punctuation\">}</span>    <span class=\"token comment\">// A positive number plus a positive number is a positive number</span>\n<span class=\"token punctuation\">{</span><span class=\"token operator\">+</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">-</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">+</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token punctuation\">}</span> \n<span class=\"token punctuation\">{</span><span class=\"token operator\">+</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">+</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token operator\">+</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">+</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">+</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token operator\">+</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">-</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">-</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span><span class=\"token operator\">+</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token number\">0</span><span class=\"token punctuation\">}</span>\netc<span class=\"token operator\">...</span></code></pre></div>\n<p>Why do such a thing?</p>\n<p>To perform a very simple static analysis of signs without having to evaluate a complete mathematical expression.</p>\n<p>For example, we don’t have to evaluate  <code class=\"language-text\">4 * -3</code> to know that the answer is negative.</p>\n<p>A short, sweet, and useful abstraction mapping in my opinion.</p>\n<p>So to tie this back together with the mapping between the real world and the abstract state.\nJust like we can create an abstraction mapping between the integers and the set of signs, we can create an abstraction mapping from the real world to our abstract state.\nOur abstract state only contains the details we are after.\nHowever, the operations and expressiveness in this more restricted domain still tell us useful things about the real world.</p>\n<h2>The concrete state</h2>\n<blockquote>\n<p><strong>The concrete state is the data types.</strong></p>\n</blockquote>\n<p>The goal is to as close as possible have a one-to-one mapping between\nthe abstract and the concrete state.</p>\n<p>This to only allow states that should exist nothing more, nothing less.</p>\n<p>Example</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// Purposly a model with a lot of bad states</span>\n<span class=\"token comment\">// Off and running ?</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">State</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\trunning<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">,</span>\n\tisOn<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">,</span>\n\ttemperature<span class=\"token operator\">:</span> Celsius\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>The interpretation of the concrete state</h2>\n<blockquote>\n<p><strong>The interpretation of the concrete state is the code</strong> <strong>using the concrete state to produce your program.</strong></p>\n</blockquote>\n<p>Imagine you have a concrete state that can represent states that should not be allowed.\nThen the solution you should <strong>always</strong> try first is to make your concrete state stricter.\nThis is because if there is no way for your concrete state to represent illegal states, then the code using that concrete state also cannot represent those states.</p>\n<p>While this is always the preferred solution, there are reasons to not follow this.</p>\n<ul>\n<li>It might be very hard to capture the details of the abstract state in your concrete state, so you will have to resort to enforcing correctness in the code.\nExample: Abstract state says that a list can only be of even length.\nMost languages will not be able to express such a thing in a reasonable way in the data type.</li>\n<li>A totally correct concrete state is not worth the performance impact.</li>\n<li>A totally correct concrete state makes the code much harder to work with, and the gains in correctness is not worth the price.</li>\n</ul>\n<p>In all of these scenarios, it’s an active choice to have an incorrect concrete state. This decision must be documented and well known. Code can/will change, and the compiler will not save you here.</p>\n<p>Unless you are making an intentional choice, make sure your concrete state corresponds precisely to your abstract state.</p>\n<p>This part touches on a much deeper topic of thinking about the logical level of your code. To learn more about that, attend the next cohort of <a href=\"https://jameskoppelcoaching.com/advanced-software-design-web-course/\">The Advanced Software Design Course</a> (one starts very soon!). For a primer read Jimmy’s article <a href=\"https://www.pathsensitive.com/2018/01/the-three-levels-of-software-why-code.html\">The Three Levels of Software</a>.</p>\n<h2>The goals of data modeling ?</h2>\n<p>Make your mappings as close as possible to one-to-one between abstract and concrete and concrete and interpreted.</p>\n<p><strong>Now on to the bugs!</strong></p>\n<h1>The four ways your state can be wrong!</h1>\n<p>Now it’s time to talk about how to spot and how to fix faulty states.\nWe will only look at the mapping between the <code class=\"language-text\">abstract state</code> and the <code class=\"language-text\">concrete state</code>. This is because any issues avoided or not avoided here will propagate onward.</p>\n<p>There are four ways for the concrete state to be incorrect. I.e., not in a one-to-one mapping with the abstract state.\n(The name of each incorrect mapping refers to the <code class=\"language-text\">concrete state.</code>)\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b541b25f06cf504e0268dcac73dd3456/e67dd/the_quadrant.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.35443037974683%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACDUlEQVQoz02STW/jIBBA8///TG/toamrbqMoyl6iSm5JaptgjG3wBybGjk0CrGKyVt5pJOYxMwwLa+16vf76+gIAfHx8dF1nrTXG2P+4+O9EEAR9389Hi6qqdrvdn4mXl5c4juu6Vkq5Y6VUURRN0+x2u9fXV9/3q6qilLorFowxIUTf9xhja63WuizL0+nk5LZtKaVKqfP5TAjp+75pGs65EOImCyGyLMvz/HA4QAiVUn3fSymdLKUUExhjCGHTNIyxOWFBCEnT1FrLGCvLUinVtu0sCyGSJMmybBzHqqqklGma1nV9l9fr9Wq1ghAGQbDf7wEAGONxHOeZwzDcbre+7x+PxzAMf39/gyAYhuEma62NMUoprfXlcjHGaK3tA5fLxQUu83EXi6ZpKKVzkp54XJJrtZto25Zz7sreZACA53nPz8/v7++e5z09PeV57kwnc86Xy+Xn5+dqtXp7e/M87+fn5y5jjIuiiOMYAIAQIoQkSfL4VQghZVkKIeI45pznee6e9t72fr+v6xpCOAyDMUZK2bbtXJxSej6fEUIAAELI8XiUUnLOjTG3PUdRhDH2J7quG4bBbcJVTtPUGHO9XqMoghAyxsZx5JzfKn9/f3uehybIBELosW0AwGazwRgzxqIoCsMwSZJ72wghCGGe50VRpGmaZVlZltfrdZaLonD3MsYopW5m97f/AdmaCLZBSt4/AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"the quadrant\"\n        title=\"the quadrant\"\n        src=\"/static/b541b25f06cf504e0268dcac73dd3456/f058b/the_quadrant.png\"\n        srcset=\"/static/b541b25f06cf504e0268dcac73dd3456/c26ae/the_quadrant.png 158w,\n/static/b541b25f06cf504e0268dcac73dd3456/6bdcf/the_quadrant.png 315w,\n/static/b541b25f06cf504e0268dcac73dd3456/f058b/the_quadrant.png 630w,\n/static/b541b25f06cf504e0268dcac73dd3456/40601/the_quadrant.png 945w,\n/static/b541b25f06cf504e0268dcac73dd3456/78612/the_quadrant.png 1260w,\n/static/b541b25f06cf504e0268dcac73dd3456/e67dd/the_quadrant.png 1801w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>Missing</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 497px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/98cad2589cab6149879700b9939b7a38/15d25/missing.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.0126582278481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAACKUlEQVQoz42TTW+qQBSG+1v7K/wFbrp049KktsZFF7CytwkL8SO0JBaBmY5QoIxRpCpfBb2CMzdxCNrbu7jv6uSc85x5c2bmiv5LhBAWHI9HFleZS11ddqdp2ul0bm9vfd9PkmQ+n7uuCyF0HMe27WpWNegbjDFut9uNRuP+/p7juLu7O47jrq+va7VavV5n8N8nE0L2+32WZbquy7IsSdLDw4MgCKPRaDweG4bR6/WazeZqtXp/f3ccZ7vdnuHtdjsYDN7e3izLQic5jjObzXieRwgBACaTCYTQ8zyM8XK5FEUxy7ISNk3TsqyfW5EkqSiKywyzrShKkiQljDGezWaU0qIoMMa73Y61AgA2mw2l9HA45HlOCMnznFI6nU6/vr5KeLPZKIrCgFar1e12Pc9L01RVVV3XLx2xACF0hn3fV1WV1fI8j6IIADCdTn+dpOs6z/ODwaCy7ThOGIYlbNs2QojV9vs980YpXSwW6/WaUirL8vPzcwUHQeC6bgmzPTOg0+lACFn88fGxXC5/2o7j2DTNEtY0LQxDwzDW63VRFNWTZBfjeV4QBNW2j8djHMeGYZSwruthGAqCcHNz8/T0NBwOTdOEEGKMfd8HALy8vLy+vgIAOI4DAKRpeoajKBJFURAEnucfHx/7J0mSpGmabdsAgH6/r2kahFBVVYSQ67qfn5/nt838EELYSvI8/31SHMdBECRJkqZplmWs4dvHIBei/yfW+QcjOGz6ZlE/cwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"missing\"\n        title=\"missing\"\n        src=\"/static/98cad2589cab6149879700b9939b7a38/15d25/missing.png\"\n        srcset=\"/static/98cad2589cab6149879700b9939b7a38/c26ae/missing.png 158w,\n/static/98cad2589cab6149879700b9939b7a38/6bdcf/missing.png 315w,\n/static/98cad2589cab6149879700b9939b7a38/15d25/missing.png 497w\"\n        sizes=\"(max-width: 497px) 100vw, 497px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>We have <strong>Missing</strong> states when abstract states exist that the concrete state cannot express.</p>\n</blockquote>\n<h3>How to spot?</h3>\n<p>Requirements that should be straightforward but are not because our concrete state is not expressive enough to include that case.</p>\n<p>The most common example is probably not having an <code class=\"language-text\">Error</code> state when one should.</p>\n<h3>How to fix?</h3>\n<blockquote>\n<p><strong>Add unique concrete states</strong></p>\n</blockquote>\n<p>Example</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// ### before ###</span>\n\n<span class=\"token comment\">// function can blow up</span>\n<span class=\"token keyword\">const</span> head <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span><span class=\"token constant\">A</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>li<span class=\"token operator\">:</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> li<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n\n<span class=\"token comment\">// ### After ###</span>\n\n<span class=\"token comment\">// Function with extra concrete state</span>\n<span class=\"token keyword\">const</span> head <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span><span class=\"token constant\">A</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span>li<span class=\"token operator\">:</span> <span class=\"token constant\">A</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> li<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token function\">just</span><span class=\"token punctuation\">(</span>li<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">nothing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Function with stricter abstract state input</span>\n<span class=\"token comment\">// Now head can't be called with an empty list, so we don't need to handle that case</span>\n<span class=\"token keyword\">const</span> <span class=\"token generic-function\"><span class=\"token function\">head</span> <span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">A</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>li<span class=\"token operator\">:</span> NonEmptyArray<span class=\"token operator\">&lt;</span><span class=\"token constant\">A</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> li<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h2>Illegal</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 484px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3605ac863781006a654db36a87324b30/ff42b/Illegal.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 80.37974683544303%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB6klEQVQoz6WSS8+iMBSG/eUu+Qeu3LhwYeJKExIxMcZgxAUS7uEmImAtFxGUREWcToY66Hy6m2dB2qbP255DG+iD/X4fx3E9/VWBvtF431GWJUKIYZjxeCyKYhRFSZLcKsIwRAg9/vKPXEfgkxmGIQii2Wx2Op12u02SpCAIWP558uPxgBDudjvP85IkGQwGrVZrOp2ORqPJZEJR1Gq1sizL8zwAAP7ilD+yYRiyLPu+77zh+/5isVBVFVQ4jmOa5raC4zjf958yx3G4pLoxeMCy7Ol0+qwLQmgYxlMWBKHuR1mWdUtUVT2fz1i73+9xHON1AIBpmk+Z5/nPk7Mso2naNE3XdXVd5ziu1+vh33E8Hr/ICKFutzscDkVRtG17NptpmhaG4e12QwgVRYHT0zS1bftLzYqiQAhxkGmaeZ7jcZqmAAAsZ1m22WxechAE79fGtRmGUdcsyzJJknj9p5znOU3Tuq4XRVGWJU5RFOV6va7Xaxx9qciy7HA4vK7NsuzlcqEoiiCIfr8vCIIsy7quC4JQlqWmaVwFy7Lz+VySpCiKLMt6ypqmLZdLx3F4nlcURZZlSZIMw8BtcxxHFMXtdovfFgDAdV3P815vG0Lo+35SASGMKoIggBVxHAcVeFuWZbiuBvoPfgNgcHFQnrjgSAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Illegal\"\n        title=\"Illegal\"\n        src=\"/static/3605ac863781006a654db36a87324b30/ff42b/Illegal.png\"\n        srcset=\"/static/3605ac863781006a654db36a87324b30/c26ae/Illegal.png 158w,\n/static/3605ac863781006a654db36a87324b30/6bdcf/Illegal.png 315w,\n/static/3605ac863781006a654db36a87324b30/ff42b/Illegal.png 484w\"\n        sizes=\"(max-width: 484px) 100vw, 484px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p><strong>illegal</strong> states are states which have no mapping to an abstract state</p>\n</blockquote>\n<p>You might have heard illegal states being talked about before, usually expressed as “Make Illegal States Unrepresentable”.</p>\n<p>There is a strong connection between <strong>Illegal</strong> states and <strong>Redundant</strong> states because sometimes it’s just a matter of perspective.</p>\n<p><em><strong>Are extra keys in a map just redundant states or illegal states?</strong></em></p>\n<h3>How to spot?</h3>\n<p>Say you are using some program, and there and in the settings, you see the following text <em>“only applies if extraFx is activated”</em>.</p>\n<p>If you use that setting anyway without activating <code class=\"language-text\">extraFx</code> and you get undefined behavior, then the application contains <strong>illegal</strong> states. If the setting is just ignored when <code class=\"language-text\">extraFx</code> is not activated, then you have <strong>redundant</strong> states.</p>\n<h3>How to fix?</h3>\n<blockquote>\n<p><strong>Remove concrete states</strong></p>\n</blockquote>\n<p>Make illegal states unrepresentable by removing possible states from your concrete state.</p>\n<p><strong>Example</strong>\n<code class=\"language-text\">hyperBlur</code> and <code class=\"language-text\">extraRainEffects</code> are options under <code class=\"language-text\">extraFx</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token punctuation\">{</span>\n  extraFx<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">,</span>\n  hyperBlur<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">,</span>\n  extraRainEffects<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">/////////////////////////</span>\n<span class=\"token comment\">// (extraFx, hyperBlur, extraRainEffects)</span>\n<span class=\"token comment\">/////////////////////////</span>\n\n<span class=\"token comment\">/////////////////////////</span>\n<span class=\"token comment\">// The states we have: 8</span>\n<span class=\"token comment\">/////////////////////////</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">////////////////////</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">//  These are all illegal</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">//  </span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">///////////////////</span>\n\n<span class=\"token comment\">/////////////////////////</span>\n<span class=\"token comment\">// the states we want: 5</span>\n<span class=\"token comment\">/////////////////////////</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">// &lt;-- Potentially also illegal depends on abstract state</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//     i.e does `extraFx` has some effect even without options ?</span>\n\n<span class=\"token comment\">/////////////////////////</span>\n<span class=\"token comment\">// Our new concrete state</span>\n<span class=\"token comment\">/////////////////////////</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ExtraFxOptions</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n   hyperBlur<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">,</span>\n   extraRainEffects<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Settings</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n extraFx<span class=\"token operator\">:</span> Off <span class=\"token operator\">|</span> ExtraFxOptions\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/////////////////////////</span>\n<span class=\"token comment\">// Even stricter concrete state without the (true,false,false) state</span>\n<span class=\"token comment\">/////////////////////////</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Settings</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n extraFx<span class=\"token operator\">:</span> Off <span class=\"token operator\">|</span> ExtraFx<span class=\"token operator\">&lt;</span>NonEmptyList<span class=\"token operator\">&lt;</span>Options<span class=\"token operator\">>></span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>Here is an example of illegal states in the <a href=\"https://github.com/bitcoin/bitcoin/blob/2f71a1ea35667b3873197201531e7ae198ec5bf4/src/coins.h#L112-L126\">bitcoin codebase</a>. These are avoided by careful coding in the interpretation of the concrete state. Can you think of ways to make the state stricter and make bugs impossible?</p>\n<h2>Redundant</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 507px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7542063ba02332f20ff73bbfdc0c1380/3ebb1/redundant.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 79.74683544303798%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAACNklEQVQoz5WSTW+qQBSG/dX+hUZXLhpXJtq46KJJY1jZrloXolZlMMBxhDBWgeGjFqcqERFprnOD9qab+y4mZ86cZ87wHgpZlp1OpyzLgiD4+vriW57ha5qmx+Mx316rkGUZP6tUKk9PT0mSMMa63W5ylm3blFJN06IoOhwOs9ksTdNf4Eaj0Ww27+7uBEGoVqu1Wq1er5fL5Zubm1KpVCwW7+/vb29vPz8/81cU+B1pmoZhCACj0Wg+n1uWtVgsNE1brVayLBuGYdt2EASO4+z3+x+doygajUYYYwDAGE+nU4yxqqq9Xg8hZBgGACiKghDCGCOENE27wJ7nIYR4f/6k9CxJkuI4/sek0+kkyzLP/4F9359MJtcY/6TxeOy6LrfKNM1Wq8VrAOACf3x8qKrKL357exsMBqIoaprW6XQkSQIAXddFUXx8fOQ1uq5vt9tfOjPGKKXdbncwGAiCYJrm4XDIJ8wDQghj7ALLspzPLC+SJElV1el0CgDtdvv5+ZmfzufzC+x5nqIouWF5oOv6ZrPhmeVyaRgGj03TXK/Xf+HlcmlZliiKr6+vYRgyxuKzACCKouFw6Lru8XgMw5AQEsfxD9i2bdM0EUL1ev3h4WE4HI7HYz7t/X4PAKIoAoAkSf1+nzFGCLnA2+325eVlNptZluU4zmKxeH9/p5RijAkhjuPYZ1FKXdd1HIcQstvtLr9nkiS+73ueFwQBpdQ/a7VaBUHgX8nzvPV6nZtfuLb3f/UNlMNpRl6tVisAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"redundant\"\n        title=\"redundant\"\n        src=\"/static/7542063ba02332f20ff73bbfdc0c1380/3ebb1/redundant.png\"\n        srcset=\"/static/7542063ba02332f20ff73bbfdc0c1380/c26ae/redundant.png 158w,\n/static/7542063ba02332f20ff73bbfdc0c1380/6bdcf/redundant.png 315w,\n/static/7542063ba02332f20ff73bbfdc0c1380/3ebb1/redundant.png 507w\"\n        sizes=\"(max-width: 507px) 100vw, 507px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>We have <strong>Redundant</strong> states when there is more than one way to represent one abstract state.</p>\n</blockquote>\n<p>As mentioned before, <strong>Redundant</strong> states have a strong connection to <strong>Illegal</strong> states.\nIt’s easy to go from having <strong>Redundant</strong> states to having <strong>Illegal</strong> states; all that one has to do is interpret one of the extra redundant states the wrong way.</p>\n<p>A easy way to add a <strong>Redundant</strong> state is adding a extra field to a map/object/record.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">Person</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n     name        <span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n   <span class=\"token punctuation\">,</span> age         <span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n   <span class=\"token punctuation\">,</span> extraField <span class=\"token operator\">:</span> <span class=\"token builtin\">any</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// or</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">Mood</span> <span class=\"token operator\">=</span> Good <span class=\"token operator\">|</span> Bad <span class=\"token operator\">|</span> AlsoGood</code></pre></div>\n<p>The first kind is not as bad as the second because extra fields in records create a subtype of the previous type, so in many cases the code will function the same as long as nothing discriminates upon it. There however still are issues like, for example, an equality check that fails because of the value of a redundant field.</p>\n<p>The second kind leads to real pain in scenarios like this: you can flip an image either by writing <code class=\"language-text\">new FlippedDrawable(image)</code> or <code class=\"language-text\">image.setFlipped(true)</code>.\nThen, to check if an image is flipped, you need to look at both every time.</p>\n<h3>How to spot?</h3>\n<p>Continuing with settings menu example from illegal.\nAnytime an application has options that only apply in specific scenarios, but they are always possible to select, there are either illegal or redundant states.\nRedundant if selecting them has no effect (noop).</p>\n<h3>How to fix?</h3>\n<blockquote>\n<p><strong>Remove concrete states</strong></p>\n</blockquote>\n<p><strong>Example</strong>\n<br>\n<em>Same example as in the illegal state, but seen from a different point of view.</em></p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">/////////////////////////</span>\n<span class=\"token comment\">// (extraFx, hyperBlur, extraRainEffects)</span>\n<span class=\"token comment\">/////////////////////////</span>\n\n<span class=\"token comment\">/////////////////////////</span>\n<span class=\"token comment\">// The states we have: 8</span>\n<span class=\"token comment\">/////////////////////////</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\">////////////////////</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">//  All of these map to the same abstract state </span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\">//  As long as extraFx is false the other fields are ignored.</span>\n<span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">///////////////////</span>\n\n<span class=\"token comment\">// Same...</span>\n</code></pre></div>\n<h2>Overloaded</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 485px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/54ed4b8640134969f239afcc4306507a/44c61/overloaded.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.64556962025317%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAACY0lEQVQoz52TzU/iQBjG/b+9Gq9ekERMxIMGiZFEvAiFA5FiKRTaSkuBdsS2UGCpLS3hw87HZpluXa/7nCYz83ufmeedOSKEYIwJIZPJhGVZCCHGGB1ECEEIQQgRQvggOpnoKBk9Pj4yDCMIAiEEQkgIsSwrCAK6GgQBhHCz2Uwmk8Qvhj3Pe3p6QghdXl4KgnBxcVEsFs/OzhiGqVarsixfXV2l0+nb29tisZhUj2GMcalUyufzlUqlUCicnp7e3Nz0er1cLpdOp+/u7nK5XCaTSaVSHMf9cAYA8Dwvy/Lr66uu66qqDgYDTdMqlcrgrzRNMwzj4+MDAPDy8hKGYQwLgjCbzWi9KIr2+30URdvtluO43W4HIYyiiEZFDfv9Pt3/BxZFcbFYJNkmm7rd7mq1ovM0cFpC13XXdWP47e1tPp8TQhRFOTk50TRtNBo5jsPzvO/7//aGFrVtm2Z+RB0cx6G9yWaziqLoug4AeH5+brfb4/HYNE3btpMmu647Ho9juNVqUZgWTgYcx4miyLLs/f39+fn5ZrOhq77vf8PJnYMgOD4+rtVq9Xqd53mGYVRVDcMQYxwEQfLsPM8zDCOGJUlar9eu64ZhyPP8er2mDgCA7Xa73+/pzekLJYR8fn7quh7DnU4HIVQul6+vr1VVtW3710HdbjeKIlEUFUUxDpJlWZKk5XIJAIjh9kEsy6ZSqYeHh2q12mg0ms2mIAi+7zuO02q1JEnq9Xocx3U6nff39+9j73Y7AIBlWbQH0+mUJmxZ1nA47Pf7w+HQsizTNJfLped5q9Xq6+vrx6/6D/0GmW1b8D2vU2sAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"overloaded\"\n        title=\"overloaded\"\n        src=\"/static/54ed4b8640134969f239afcc4306507a/44c61/overloaded.png\"\n        srcset=\"/static/54ed4b8640134969f239afcc4306507a/c26ae/overloaded.png 158w,\n/static/54ed4b8640134969f239afcc4306507a/6bdcf/overloaded.png 315w,\n/static/54ed4b8640134969f239afcc4306507a/44c61/overloaded.png 485w\"\n        sizes=\"(max-width: 485px) 100vw, 485px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>A state is <strong>Overloaded</strong> if we have one concrete state representing two abstract states.</p>\n</blockquote>\n<p>This is probably the most common bug I run into when using software.</p>\n<h3>How to spot?</h3>\n<p>Have you ever used a piece of software, and the following occurs?</p>\n<ol>\n<li>There is text saying “no messages | likes | etc…”</li>\n<li>A second later, the data does pop up.</li>\n</ol>\n<p>If you have, then you have observed the effect of overloading.</p>\n<p>Say you have a model like this</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">State</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  isLoading<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">,</span>\n  data<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then there is no way to differentiate these two abstract states</p>\n<ul>\n<li>Empty list because nothing was returned from the backend</li>\n<li>Empty list because we have not asked for it yet</li>\n</ul>\n<p>So we need extra contextual information to know how to interpret the state.\nIt’s not possible from how the state is currently designed to make that distinction.</p>\n<p>Both Slack and Twitter have had this bug. And you can read more about\nit in this excellent blog post.\n<a href=\"http://blog.jenkster.com/2016/06/how-elm-slays-a-ui-antipattern.html\">How elm slays a common UI Antipattern</a></p>\n<h3>How to fix?</h3>\n<blockquote>\n<p><strong>Add unique concrete states</strong></p>\n</blockquote>\n<p>How do we make it so we can differentiate these two abstract states ?</p>\n<ul>\n<li>Empty list because nothing was returned from the backend</li>\n<li>Empty list because we have not asked for it yet</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">State</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  isLoading<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">,</span>\n  data<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If we start by asking ourselves what states should exist for data fetched from a backend, it becomes clear that these four states are a better abstract description of what is going on.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">State</span> <span class=\"token operator\">=</span> NotAsked <span class=\"token operator\">|</span> Loading <span class=\"token operator\">|</span> Success<span class=\"token operator\">&lt;</span>List<span class=\"token operator\">&lt;</span><span class=\"token builtin\">number</span><span class=\"token operator\">>></span> <span class=\"token operator\">|</span> Failure<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></code></pre></div>\n<p>So if we instead use that as our concrete state there would now be a distinction between <code class=\"language-text\">NotAsked</code> and <code class=\"language-text\">Success&lt;List&lt;number>></code>.</p>\n<p>Depending on our abstract state requirements, we can take this further or be happy with this.</p>\n<p><em>How would you change the model to allow for pagination while keeping the current data you already have?</em></p>\n<h2>I was promised a mnemonic! Where is it?</h2>\n<p>I will give you two for the price of one!</p>\n<blockquote>\n<p><strong>When designing your data model avoid MIRO concrete states</strong></p>\n</blockquote>\n<p>If you don’t like avoiding the painter <a href=\"https://www.wikiwand.com/en/Joan_Mir%C3%B3\">MIRO</a> spilling paint all over your code, then change <strong>Redundant</strong> to <strong>Superfluous</strong>, and you got <strong>MISO</strong> Soup! Don’t drop <strong>MISO</strong> in your code! <em>(For a quick demonstration of the effects, pour some MISO soup into your computer and see what happens!)</em>.</p>\n<h3>M -> I ->  R -> O</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d9b986ddf920ebf5c63c46b26d82acf9/719d0/MIRO.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.25316455696203%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqUlEQVQozz2Se2/TMBTF81X5GID4CySEeAgQME1ICJgAaYINscK6rV0fi7qlY90KgzRrS7OmdZzYifNOGtc2pBU7si3ryj/p3HMtiYUODg70S/3813mnc8IYK0qM82IVWwgRJ7Esy5qmAQDEf0lpmmKMm81mo95s7B9WKjIJ4yhLOefLFzllScp8P6nXG5VKpd/ve55n2zbnXLJtG2OUpKkbwra6oY0/HR6tfv12V5afdZUPQ6Ws7Kwdye+GeiMMPYydJImDIIAQUkoljFGcpMPez9rn1c039/Y+PwcXHf20A3+rwWAcjyaD7+3RWWt/Y+XT21uXuu66rueRIAgKGCFkmqZlmmxGXRIm6VwI4QdBntOlbew40MIpE6326k95J8koNE1CSJ7nkud5tVpNURT9Uu/1VFX9raqqaZpszsSi6yiKfnTPOp2uolT3Np//0S81TTMMowiMFXlyxhildL4QX+gqUs75nBYusiis1e5SMVsWC7gwhjEhRAgxn8+X5xW8vCCEMMJJlh1tv5yAXhxneZ4XMOe82+1Wq9XS1la9Xt8ub5dKpSRJluQSHo1G5fK28v1k/cWD9Y+rrVZ7OW3Jdd3pdIoxBpY91HVo2TbCEFqU0qJnLmbpDBhmFCdxPC+vPR5Pz23bsSwYRZHkLDz3NO1HdafT3HNdkIYOMIZh5DCRc0GjzLPIBMI/X97fX9+8bSFsjI00TX3flzDGYRj2L/qvb1x7//TmVumJUl/Z33rU+PqwuXOvtntn99vtjfXrjb07yumr3kg1p9B13dlsVsBBEBwfHx/IcuesMtIvphAaYGpMJnk2o0GS+V5MvKNmq33SxsSfGmAw6Pf7AwBAGIZSlmXj8RgAQEjoOi6EENnI94OrUTHGkIOhCS3LwgshhAgh/37YX+eW6dO+qjNSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"MIRO\"\n        title=\"MIRO\"\n        src=\"/static/d9b986ddf920ebf5c63c46b26d82acf9/f058b/MIRO.png\"\n        srcset=\"/static/d9b986ddf920ebf5c63c46b26d82acf9/c26ae/MIRO.png 158w,\n/static/d9b986ddf920ebf5c63c46b26d82acf9/6bdcf/MIRO.png 315w,\n/static/d9b986ddf920ebf5c63c46b26d82acf9/f058b/MIRO.png 630w,\n/static/d9b986ddf920ebf5c63c46b26d82acf9/40601/MIRO.png 945w,\n/static/d9b986ddf920ebf5c63c46b26d82acf9/78612/MIRO.png 1260w,\n/static/d9b986ddf920ebf5c63c46b26d82acf9/719d0/MIRO.png 1779w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n<br>\nIf this article intrigued you and you like thinking deeply about software you should consider joining the <em>Advanced software design course</em>. That is where I started as a student and learned the deeper foundations that underlay all software. That knowledge led me to the ideas that underlay this article.\n<br>\n<strong>The next batch of the Advanced Software Design course starts on the 23 of June. <a href=\"https://jameskoppelcoaching.com/advanced-software-design-web-course/\">Click here to join</a>.</strong></p>\n<h2>Introducing the State Fixagram™!</h2>\n<p>I will leave you with this easy to follow <strong>Fixagram™</strong>.\nNext time you find yourself with an invalid state, don’t fret! Just follow the <strong>Fixagram™</strong>, and you will be alright.\n<strong>No need for a state of emergency!</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d7860a7028f21cd21be1cd235625411e/0d6fe/fixagram.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 119.62025316455697%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAIAAAB1KUohAAAACXBIWXMAAAsTAAALEwEAmpwYAAADSklEQVQ4y4VUaU/rOhTs//8xIAFCSAgErWgrqtA2XUmdOvu+OI7tZq3fI47yuPfLmw+WsszxeM4cjzjnQRB8fHyMx+PHx8fn5+e3t7fpdDqfz19fXxeLhSRJ0+l00uHl5eX+/v729tZxHM75iHM+n8/Fw3a7XS6XWZZ5ntc0jaIoDw8PqqpaluU4jqIoURRxzn3flySpJ8uyjBDinGuaNpvNJEl6f3/HGLdte3Nzc3d39/T0tN1u1+u1pmlVVcVxfDgcevJkMhmPx5+fn7PZ7Ovra91B7vD9/Q0h1HVdURTY4Xw+r9fr3W7XkxeLhaZpvMP1euWcF0Uhy7Ku6wCA0+nE/wSlVPw/opSKMtcO4nOapr7vQwg1TYuiSBxq+IEQAgD4IRNC9vs957xt26F2mqYYY8/zdF2nlBJCfu9MCFFVtd/5eDwOgsXqed5utzMMAwBg23aWZX+Rz+fzD/lyuQjrBs2c87quT6cTpbRtW1VVkyT5S3ZPZoz9JjPGhLHiJefcsqzZbHY8Hj3PE/oppbqu97LF6a/Xa9M0VVVlWWYYRtM0g/8AAEppWZbCF0ophLAni2a0bSvL8msHTdPathVaqqoKw3AymSyXS4RQXdeMsf9aJQxLOoRh6Pt+WZZDe5IkKYoiTdM8z7Mso5Qyxnq3kyQRZRBCcRwnSWLbdlVVeZ6LnUXRKIowxnEcF0VBKe3Jpmn6vi9mS5Ik3/dN0zQMQ+zMOXdd93A4WJZl27ZlWZfLhTHWu62qahAEZVlSSvM8t23bNM22w+/Amh0YY4SQOI57t8MwhBCGYeg4Tthh6OpvcpZlcRyL2LquaxjGH/Gs69p1XXFCoWUIDITQ6eC6Luf8crn0rSKEiMFACK1Wq/l8LlbP84YZ2mw2siwvl8vVaoUxLsuyl10UhQgTQigIgiiK4jhumgZjLARjjIuicF3X932EkMisaZp1Xf/M8+FwKMsSYwwAgBACAJIkGYYBIeQ4jmVZQxcEuSiKkbi6EEJCv2EYtm0bhpGm6fV6bdtWJDlJEoRQFEWMMc75fr8nhPyQ8zzfbDbH41FRFADA+XyGEJ5OJ3GNaJoWBIEwLOjguu5qtSrLcsT/D2VZCiNE/kTPKKX/GvYPgAguW6UvdpkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"fixagram\"\n        title=\"fixagram\"\n        src=\"/static/d7860a7028f21cd21be1cd235625411e/f058b/fixagram.png\"\n        srcset=\"/static/d7860a7028f21cd21be1cd235625411e/c26ae/fixagram.png 158w,\n/static/d7860a7028f21cd21be1cd235625411e/6bdcf/fixagram.png 315w,\n/static/d7860a7028f21cd21be1cd235625411e/f058b/fixagram.png 630w,\n/static/d7860a7028f21cd21be1cd235625411e/40601/fixagram.png 945w,\n/static/d7860a7028f21cd21be1cd235625411e/0d6fe/fixagram.png 1115w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"State of emergency! The four ways your state might be wrong","date":"June 19, 2022","description":"Alert! Your state might already be infected! learn how and what todo about it in this article."}},"previous":null,"next":{"fields":{"slug":"/typelevel-tic-tac-toe-in-typescript/"},"frontmatter":{"title":"TypeScript Typelevel Tic-Tac-Toe: Overkill edition!"}}},"pageContext":{"id":"213c12e4-1c3c-56ac-9b0c-6225e73b7686","previousPostId":null,"nextPostId":"117b4651-b893-5734-987d-14f8543528ab"}},"staticQueryHashes":["2841359383","3257411868"]}